module.exports=function(t){var e={};function o(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=48)}([function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e,o){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}o.d(e,"a",(function(){return a}))},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e,o){"use strict";e.a=function(t){return!1===t&&(t=[]),t.slice(0).sort((function(t,e){var o=t.order()-e.order();return 0!==o?o:t.name()>e.name()?1:t.name()<e.name()?-1:0}))}},,function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return r}));var n=o(11),a=o.n(n);function r(t,e,o){void 0===e&&(e={}),void 0===o&&(o={});var n=t&&t.icon(),r=o.useColor,s=void 0===r||r;return e.className=a()([e.className,"icon",n?t.icon():"TaxonomyIcon"]),t?(e.style=e.style||{},n?e.style.color=s?t.color():"":e.style.backgroundColor=t.color()):e.className+=" untagged",n?m("i",e):m("span",e)}},function(t,e){t.exports=flarum.core.compat["common/utils/extract"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return j}));var n=o(1),a=o(15),r=o.n(a),s=o(18),i=o.n(s),c=o(3),u=o.n(c),l=o(6),p=o.n(l),f=o(27),d=o.n(f),h=o(11),x=o.n(h),y=o(19),v=o.n(y),T=o(10),b=o.n(T),g=o(13),k=o(7),O=o(16),w=function(){function t(){this.callbacks=new Map,this.whenCallback=function(t){return!0}}var e=t.prototype;return e.onUp=function(t){return this.callbacks.set(38,(function(e){e.preventDefault(),t(e)})),this},e.onDown=function(t){return this.callbacks.set(40,(function(e){e.preventDefault(),t(e)})),this},e.onSelect=function(t){var e=function(e){e.preventDefault(),t(e)};return this.callbacks.set(9,e),this.callbacks.set(13,e),this},e.onCancel=function(t){return this.callbacks.set(27,(function(e){e.stopPropagation(),e.preventDefault(),t(e)})),this},e.onRemove=function(t){return this.callbacks.set(8,(function(e){0===e.target.selectionStart&&0===e.target.selectionEnd&&(t(e),e.preventDefault())})),this},e.when=function(t){return this.whenCallback=t,this},e.bindTo=function(t){t.on("keydown",this.navigate.bind(this))},e.navigate=function(t){if(this.whenCallback(t)){var e=this.callbacks.get(t.which);e&&e(t)}},t}();var j=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).availableTerms=null,e.selectedTerms=[],e.searchFilter="",e.activeListIndex=0,e.inputIsFocused=!1,e.saving=!1,e.navigator=void 0,e.attrs=void 0,e}Object(n.a)(e,t);var o=e.prototype;return o.oninit=function(e){var o=this;t.prototype.oninit.call(this,e),this.attrs.selectedTerms?this.attrs.selectedTerms.forEach(this.addTerm.bind(this)):this.attrs.resource&&this.attrs.resource.taxonomyTerms().forEach((function(t){t.taxonomy().id()===o.attrs.taxonomy.id()&&o.addTerm(t)})),app.request({method:"GET",url:app.forum.attribute("apiUrl")+this.attrs.taxonomy.apiEndpoint()+"/terms"}).then((function(t){o.availableTerms=app.store.pushPayload(t),m.redraw()})),this.navigator=new w,this.navigator.onUp((function(){return o.setIndex(o.activeListIndex-1,!0)})).onDown((function(){return o.setIndex(o.activeListIndex+1,!0)})).onSelect(this.select.bind(this)).onRemove((function(){o.selectedTerms.length&&o.toggleTerm(o.selectedTerms[o.selectedTerms.length-1])})).when((function(t){return" "!==t.key||""!==o.searchFilter||(t.preventDefault(),o.select(t),!1)}))},o.indexInSelectedTerms=function(t){return this.selectedTerms.findIndex((function(e){return n=t,(o=e).data.type===n.data.type&&(o.id()&&n.id()?o.id()===n.id():!o.id()==!n.id()&&o.name()===n.name());var o,n}))},o.addTerm=function(t){this.selectedTerms.push(t)},o.removeTerm=function(t){var e=this.indexInSelectedTerms(t);-1!==e&&this.selectedTerms.splice(e,1)},o.className=function(){return"ChooseTaxonomyTermsModal"},o.title=function(){return this.attrs.resource?app.translator.trans("flamarkt-taxonomies.lib.modal.title.edit",{taxonomy:this.attrs.taxonomy.name(),title:m("em",this.attrs.resource.title?this.attrs.resource.title():this.attrs.resource.displayName())}):app.translator.trans("flamarkt-taxonomies.lib.modal.title.new",{taxonomy:this.attrs.taxonomy.name()})},o.getInstruction=function(){var t=this.selectedTerms.length;if(this.attrs.taxonomy.minTerms()&&t<this.attrs.taxonomy.minTerms()){var e=this.attrs.taxonomy.minTerms()-t;return app.translator.trans("flamarkt-taxonomies.lib.modal.placeholder",{count:e})}return 0===t?app.translator.trans("flamarkt-taxonomies.lib.modal.placeholderOptional"):""},o.filteredAvailableTerms=function(){var t=null===this.availableTerms?[]:this.availableTerms,e=this.searchFilter.toLowerCase();if(e&&(t=t.filter((function(t){return t.name().substr(0,e.length).toLowerCase()===e})),this.attrs.taxonomy.allowCustomValues()&&!t.some((function(t){return t.name().toLowerCase()===e})))){var o=this.attrs.taxonomy.customValueValidation(),n=null;if("alpha_num"===o)n=/^[a-z0-9]$/i;else if("alpha_dash"===o)n=/^[a-z0-9_-]$/i;else if(0===o.indexOf("/")){var a=o.split("/");3===a.length&&(n=new RegExp(a[1],a[2]))}n&&!n.test(this.searchFilter)||t.push(app.store.createRecord("flamarkt-taxonomy-terms",{attributes:{name:this.searchFilter}}))}return this.attrs.taxonomy.maxTerms()&&this.selectedTerms.length>=this.attrs.taxonomy.maxTerms()&&(t=[]),t},o.content=function(){return[this.viewForm(),this.listAvailableTerms(this.filteredAvailableTerms())]},o.viewForm=function(){var t=this.attrs.taxonomy.description();return m(".Modal-body",[t?m("p",t):null,m(".ChooseTaxonomyTermsModal-form",this.formItems().toArray())])},o.formItems=function(){var t=new v.a;return t.add("input",m(".ChooseTaxonomyTermsModal-form-input",m(".TermsInput.FormControl",{className:this.inputIsFocused?"focus":""},this.inputItems().toArray())),20),t.add("submit",m(".ChooseTaxonomyTermsModal-form-submit.App-primaryControl",u.a.component({type:"submit",className:"Button Button--primary",disabled:this.attrs.taxonomy.minTerms()&&this.selectedTerms.length<this.attrs.taxonomy.minTerms(),icon:"fas fa-check",loading:this.saving},app.translator.trans("flamarkt-taxonomies.lib.modal.submit"))),10),t},o.inputItems=function(){var t=this,e=new v.a;return e.add("selected",this.selectedTerms.map((function(e){return m("span.TermsInput-term",{onclick:function(){t.toggleTerm(e),t.onready()}},Object(g.a)(e))})),20),e.add("control",m("input.FormControl",{placeholder:b()(this.getInstruction()),value:this.searchFilter,oninput:function(e){t.searchFilter=e.target.value,t.activeListIndex=0},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:this.oninputfocus.bind(this),onblur:this.oninputblur.bind(this)}),10),e},o.oninputfocus=function(){this.inputIsFocused=!0},o.oninputblur=function(){this.inputIsFocused=!1},o.listAvailableTerms=function(t){return m(".Modal-footer",null===this.availableTerms?p.a.component():m("ul.ChooseTaxonomyTermsModal-list.SelectTermList",{className:t.some((function(t){return t.description()}))?"SelectTermList--with-descriptions":""},t.map(this.listAvailableTerm.bind(this))))},o.listAvailableTerm=function(t,e){var o=this;return m("li.SelectTermListItem",{"data-index":e,className:x()({colored:!!t.color(),selected:-1!==this.indexInSelectedTerms(t),active:this.activeListIndex===e}),style:{color:t.color()},onmouseover:function(){return o.activeListIndex=e},onclick:this.toggleTerm.bind(this,t)},[Object(k.a)(t),m("span.SelectTermListItem-name",t.exists?d()(t.name(),this.searchFilter):app.translator.trans("flamarkt-taxonomies.lib.modal.custom",{value:m("em",t.name())})),t.description()?m("span.SelectTermListItem-description",t.description()):""])},o.toggleTerm=function(t){var e=this;-1!==this.indexInSelectedTerms(t)?this.removeTerm(t):this.addTerm(t),this.searchFilter&&(this.searchFilter="",this.activeListIndex=0),setTimeout((function(){e.onready()}))},o.select=function(t){var e=this.getDomElement(this.activeListIndex);e.length?t.metaKey||t.ctrlKey||e.is(".selected")?this.selectedTerms.length&&this.onsubmit():e[0].dispatchEvent(new Event("click")):this.searchFilter=""},o.getDomElement=function(t){return this.$('.SelectTermListItem[data-index="'+t+'"]')},o.setIndex=function(t,e){var o=this.$(".ChooseTaxonomyTermsModal-list"),n=this.$(".SelectTermListItem").length;t<0?t=n-1:t>=n&&(t=0);var a=this.getDomElement(t);if(this.activeListIndex=t,m.redraw(),e){var r,s,i,c=o.scrollTop()||0,u=(null==(r=o.offset())?void 0:r.top)||0,l=u+(o.outerHeight()||0),p=(null==(s=a.offset())?void 0:s.top)||0,f=p+(a.outerHeight()||0);p<u?i=c-u+p-parseInt(o.css("padding-top"),10):f>l&&(i=c-l+f+parseInt(o.css("padding-bottom"),10)),void 0!==i&&o.stop(!0).animate({scrollTop:i},100)}},o.onsubmit=function(t){t&&t.preventDefault(),this.attrs.resource?this.saveResource():(this.attrs.onsubmit&&this.attrs.onsubmit(this.selectedTerms),app.modal.close())},o.saveResource=function(){this.saving=!0,this.attrs.resource.save({relationships:{taxonomies:[{verbatim:!0,type:"flamarkt-taxonomies",id:this.attrs.taxonomy.id(),relationships:{terms:{data:this.selectedTerms.map(O.a)}}}]}}).then(this.onsaved.bind(this),this.onerror.bind(this))},o.onsaved=function(){i.a&&app.current.matches(i.a)&&app.current.get("stream").update(),this.saving=!1,m.redraw(),app.modal.close()},o.onerror=function(){this.saving=!1,m.redraw()},e}(r.a)},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,e){t.exports=flarum.core.compat["common/utils/classList"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return s}));var n=o(1),a=o(0),r=o.n(a),s=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).name=r.a.attribute("name"),e.slug=r.a.attribute("slug"),e.description=r.a.attribute("description"),e.color=r.a.attribute("color"),e.icon=r.a.attribute("icon"),e.order=r.a.attribute("order"),e.createdAt=r.a.attribute("createdAt",r.a.transformDate),e.taxonomy=r.a.hasOne("taxonomy"),e}return Object(n.a)(e,t),e.prototype.apiEndpoint=function(){return"/flamarkt/taxonomy-terms"+(this.exists?"/"+this.data.id:"")},e}(r.a)},function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));var n=o(8),a=o.n(n),r=o(12),s=o(7);function i(t,e){void 0===t&&(t=null),void 0===e&&(e={}),e.style=e.style||{},e.className="TaxonomyLabel "+(e.className||"");var o=a()(e,"discussionLink"),n=a()(e,"userLink"),i=t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text"),c="span";if(t){var u=t.color();if(u&&(e.style.backgroundColor=e.style.color=u,e.className+=" colored"),t instanceof r.a&&t.taxonomy()&&t.taxonomy().showFilter()){var l;if(o)e.title=t.description()||"",e.href=app.route("index",((l={})[t.taxonomy().slug()]=t.slug(),l)),e.config=m.route,c="a";n&&app.routes.fof_user_directory&&(e.title=t.description()||"",e.href=app.route("fof_user_directory",{q:"taxonomy:"+t.taxonomy().slug()+":"+t.slug()}),e.config=m.route,c="a")}}else e.className+=" untagged";return m(c,e,m("span.TaxonomyLabel-text",[t&&t.icon()&&Object(s.a)(t,{},{useColor:!1})," "+i]))}},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e,o){"use strict";var n=o(17),a=o(0),r=o.n(a);e.a=function(t){return t.id()?r.a.getIdentifier(t):Object(n.a)({},r.a.getIdentifier(t),{attributes:{name:t.name()}})}},function(t,e,o){"use strict";function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t}).apply(this,arguments)}o.d(e,"a",(function(){return n}))},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e,o){"use strict";e.a=function(t){return t.slice(0).sort((function(t,e){var o=t.order()-e.order();return 0!==o?o:t.name()>e.name()?1:t.name()<e.name()?-1:0}))}},function(t,e){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,e){t.exports=flarum.core.compat["common/models/Forum"]},function(t,e){t.exports=flarum.core.compat["common/models/User"]},function(t,e){t.exports=flarum.extensions["flamarkt-core"].common["models/Product"]},function(t,e){t.exports=flarum.core.compat["common/helpers/highlight"]},function(t,e,o){"use strict";var n=o(23),a=o.n(n),r=o(24),s=o.n(r),i=o(25),c=o.n(i),u=o(0),m=o.n(u),l=o(26),p=o.n(l),f=o(1),d=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).type=m.a.attribute("type"),e.name=m.a.attribute("name"),e.slug=m.a.attribute("slug"),e.description=m.a.attribute("description"),e.color=m.a.attribute("color"),e.icon=m.a.attribute("icon"),e.order=m.a.attribute("order"),e.showLabel=m.a.attribute("showLabel"),e.showFilter=m.a.attribute("showFilter"),e.allowCustomValues=m.a.attribute("allowCustomValues"),e.customValueValidation=m.a.attribute("customValueValidation"),e.customValueSlugger=m.a.attribute("customValueSlugger"),e.minTerms=m.a.attribute("minTerms"),e.maxTerms=m.a.attribute("maxTerms"),e.createdAt=m.a.attribute("createdAt",m.a.transformDate),e.canSearch=m.a.attribute("canSearch"),e}Object(f.a)(e,t);var o=e.prototype;return o.apiEndpoint=function(){return"/flamarkt/taxonomies"+(this.exists?"/"+this.data.id:"")},o.apiOrderEndpoint=function(){return this.apiEndpoint()+"/terms/order"},o.apiTermsEndpoint=function(){return this.apiEndpoint()+"/terms"},e}(m.a),h=o(12);e.a=function(){app.store.models["flamarkt-taxonomies"]=d,app.store.models["flamarkt-taxonomy-terms"]=h.a,s.a.prototype.taxonomies=m.a.hasMany("taxonomies"),a.a.prototype.taxonomyTerms=m.a.hasMany("taxonomyTerms"),c.a.prototype.taxonomyTerms=m.a.hasMany("taxonomyTerms"),p.a.prototype.taxonomyTerms=m.a.hasMany("taxonomyTerms")}},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionComposer"]},,,function(t,e){t.exports=flarum.core.compat["forum/components/UserPage"]},,,,,,function(t,e){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(t,e){t.exports=flarum.core.compat["forum/states/GlobalSearchState"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionHero"]},function(t,e){t.exports=flarum.extensions["flamarkt-core"].forum["layouts/ProductIndexLayout"]},function(t,e){t.exports=flarum.extensions["flamarkt-core"].forum["pages/ProductIndexPage"]},function(t,e){t.exports=flarum.core.compat["forum/utils/UserControls"]},function(t,e,o){"use strict";o.r(e);var n=o(2),a=o(29),r=o.n(a),s=o(14),i=o.n(s),c=o(9),u=o(8),l=o.n(u),p=o(13),f=o(22);function d(t,e){void 0===e&&(e={});var o=[],n=l()(e,"discussionLink"),a=l()(e,"userLink");if(e.className="TaxonomiesLabel "+(e.className||""),t){var r=l()(e,"taxonomy");r||(r=t[0].taxonomy()),r&&(e["data-slug"]=r.slug(),r.showLabel()&&o.push(Object(p.a)(r,{className:"TaxonomyParentLabel"}))),Object(f.a)(t).forEach((function(e){(e||1===t.length)&&o.push(Object(p.a)(e,{discussionLink:n,userLink:a}))}))}else o.push(Object(p.a)());return m("span",e,o)}var h=o(4),x=o(16),y=o(38),v=o.n(y),T=o(3),b=o.n(T),g=o(39),k=o.n(g),O=o(40),w=o.n(O),j=o(41),I=o.n(j),L=o(1),E=o(21),S=o.n(E),C=o(42),P=o.n(C),F=o(6),A=o.n(F),D=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).termsInitialized=!1,e.terms=null,e}Object(L.a)(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.attrs.activeTermSlug&&this.loadTerms()},o.loadTerms=function(){var t=this;this.termsInitialized||(this.termsInitialized=!0,app.request({method:"GET",url:app.forum.attribute("apiUrl")+this.attrs.taxonomy.apiTermsEndpoint()}).then((function(e){t.terms=app.store.pushPayload(e),t.terms.forEach((function(e){e.pushData({relationships:{taxonomy:t.attrs.taxonomy}})})),m.redraw()})))},o.view=function(){var t=this,e=this.terms&&this.terms.find((function(e){return e.slug()===t.attrs.activeTermSlug}));return P.a.component({buttonClassName:"Button",label:this.attrs.taxonomy.name()+(e?": "+e.name():""),onshow:function(){t.loadTerms()}},null===this.terms?[A.a.component()]:this.terms.map((function(e){var o=t.attrs.activeTermSlug===e.slug();return b.a.component({icon:!o||"fas fa-check",onclick:function(){return t.attrs.onchange(e)},active:o},e.name())})))},e}(S.a),N=function(t){return function(e){return e.type()===t&&e.canSearch()&&e.showFilter()}},M=o(43),_=o.n(M),q=o(44),U=o.n(q),V=function(t,e){void 0===e&&(e={});var o=[];return t.forEach((function(t){var e=t.taxonomy();-1===o.indexOf(e)&&o.push(e)})),Object(h.a)(o).map((function(o){return d(t.filter((function(t){return t.taxonomy()===o})),e)}))},z=o(32),R=o.n(z),$=function(t){function e(){return t.apply(this,arguments)||this}Object(L.a)(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},o.content=function(){var t=this.user.taxonomyTerms();if(!t||!t.length)return null;var e=[];return t.forEach((function(t){var o=t.taxonomy();o&&-1===e.indexOf(o)&&e.push(o)})),Object(h.a)(e).map((function(e){return[m("h2",e.name()),d(t.filter((function(t){return t.taxonomy()===e})),{userLink:!0})]}))},e}(R.a),B=o(17),G=o(45),H=o.n(G),K=o(46),J=o.n(K),Q=o(47),W=o.n(Q),X=o(20),Y=o.n(X),Z=o(28);app.initializers.add("flamarkt-taxonomies",(function(){Object(n.extend)(r.a.prototype,"oninit",(function(){this.selectedTaxonomyTerms={}})),Object(n.extend)(r.a.prototype,"headerItems",(function(t){var e=this;Object(h.a)(app.forum.taxonomies()).forEach((function(o){"discussions"===o.type()&&t.add("taxonomy-"+o.slug(),m("a.DiscussionComposer-changeTaxonomies",{onclick:function(){app.modal.show(c.a,{taxonomy:o,selectedTerms:(e.selectedTaxonomyTerms[o.id()]||[]).slice(0),onsubmit:function(t){e.selectedTaxonomyTerms[o.id()]=t,e.$("textarea").trigger("focus")}})}},e.selectedTaxonomyTerms[o.id()]&&e.selectedTaxonomyTerms[o.id()].length?d(e.selectedTaxonomyTerms[o.id()],{taxonomy:o}):m("span.TaxonomyLabel.untagged",[o.icon()?[i()(o.icon())," "]:null,app.translator.trans("flamarkt-taxonomies.forum.composer.choose",{taxonomy:o.name()})])),9)}))})),Object(n.override)(r.a.prototype,"onsubmit",(function(t){var e=this,o=[];if(Object(h.a)(app.forum.taxonomies()).forEach((function(t){if("discussions"===t.type()){var n=(e.selectedTaxonomyTerms[t.id()]||[]).length;t.minTerms()&&n<t.minTerms()&&o.push((function(o){app.modal.show(c.a,{taxonomy:t,selectedTags:(e.selectedTaxonomyTerms[t.id()]||[]).slice(0),onsubmit:function(n){e.selectedTaxonomyTerms[t.id()]=n,o()}})}))}})),o.length){var n=function e(){o.length?new Promise(o.shift()).then((function(){setTimeout((function(){e()}),400)})):t()};app.modal.modal?setTimeout((function(){n()}),400):n()}else t()})),Object(n.extend)(r.a.prototype,"data",(function(t){var e=this,o=[];(app.forum.taxonomies()||[]).forEach((function(t){"discussions"===t.type()&&e.selectedTaxonomyTerms[t.id()]&&e.selectedTaxonomyTerms[t.id()].length&&o.push({verbatim:!0,type:"flamarkt-taxonomies",id:t.id(),relationships:{terms:{data:e.selectedTaxonomyTerms[t.id()].map(x.a)}}})})),t.relationships=t.relationships||{},t.relationships.taxonomies=o})),Object(n.extend)(v.a,"moderationControls",(function(t,e){e.attribute("canEditTaxonomies")&&Object(h.a)(app.forum.taxonomies()).forEach((function(o){"discussions"===o.type()&&t.add("taxonomy-"+o.slug(),b.a.component({icon:"fas fa-tag",onclick:function(){return app.modal.show(c.a,{resource:e,taxonomy:o})}},app.translator.trans("flamarkt-taxonomies.forum.discussion.edit",{taxonomy:o.name()})))}))})),Object(n.extend)(k.a.prototype,"viewItems",(function(t){var e=this;Object(h.a)(app.store.all("flamarkt-taxonomies")).filter(N("discussions")).forEach((function(o){t.add("taxonomy-"+o.slug(),D.component({taxonomy:o,activeTermSlug:app.search.params()[o.slug()],onchange:function(t){var n=app.search.params(),a=n[o.slug()];t.slug()===a?delete n[o.slug()]:n[o.slug()]=t.slug();var r=e.attrs.routeName;m.route.set(app.route(r,n))}}))}))})),Object(n.extend)(I.a.prototype,"stickyParams",(function(t){Object(h.a)(app.store.all("flamarkt-taxonomies")).filter(N("discussions")).forEach((function(e){t[e.slug()]=m.route.param(e.slug())}))})),Object(n.extend)(w.a.prototype,"requestParams",(function(t){var e=this;t.include.push("taxonomyTerms","taxonomyTerms.taxonomy"),Object(h.a)(app.store.all("flamarkt-taxonomies")).filter(N("discussions")).forEach((function(o){var n=e.params[o.slug()];n&&(t.filter.q=(t.filter.q||"")+" taxonomy:"+o.slug()+":"+n)}))})),Object(n.extend)(_.a.prototype,"infoItems",(function(t){var e=this.attrs.discussion.taxonomyTerms();e&&e.length&&t.add("taxonomies",V(e),10)})),Object(n.extend)(U.a.prototype,"items",(function(t){var e=this.attrs.discussion.taxonomyTerms();e&&e.length&&t.add("taxonomies",V(e,{discussionLink:!0}),5)})),app.routes.flamarktTaxonomiesUser={path:"/u/:username/taxonomies",component:$},app.route.flamarktTaxonomiesUser=function(t){return app.route("flamarktTaxonomiesUser",{username:t.username()})},Object(n.extend)(H.a.prototype,"filters",(function(t){Object(h.a)(app.store.all("flamarkt-taxonomies")).filter(N("products")).forEach((function(e){t.add("taxonomy-"+e.slug(),D.component({taxonomy:e,activeTermSlug:m.route.param()[e.slug()],onchange:function(t){var o=Object(B.a)({},m.route.param());delete o.key;var n=o[e.slug()];t.slug()===n?delete o[e.slug()]:o[e.slug()]=t.slug();var a=app.current.data.routeName;m.route.set(app.route(a,o))}}))}))})),Object(n.extend)(J.a.prototype,"initState",(function(t){var e=m.route.param();Object(h.a)(app.store.all("flamarkt-taxonomies")).filter(N("products")).forEach((function(o){var n=e[o.slug()];n&&(t.params.q=(t.params.q||"")+" taxonomy:"+o.slug()+":"+n)}))})),Object(n.extend)(W.a,"userControls",(function(t,e){e.attribute("canEditTaxonomies")&&Object(h.a)(app.forum.taxonomies()).forEach((function(o){"users"===o.type()&&t.add("taxonomy-"+o.slug(),b.a.component({icon:"fas fa-tag",onclick:function(){return app.modal.show(c.a,{resource:e,taxonomy:o})}},app.translator.trans("flamarkt-taxonomies.forum.user.edit",{taxonomy:o.name()})))}))})),Object(n.extend)(R.a.prototype,"navItems",(function(t){Object(h.a)(app.forum.taxonomies()).some((function(t){return"users"===t.type()}))&&t.add("taxonomies",Y.a.component({href:app.route.flamarktTaxonomiesUser(this.user),icon:"fas fa-tags"},app.translator.trans("flamarkt-taxonomies.forum.user.nav")),120)})),Object(Z.a)(),function(){if(flarum.extensions["fof-user-directory"]&&flarum.extensions["fof-user-directory"].searchTypes&&flarum.extensions["fof-user-directory"].searchTypes.AbstractType&&flarum.extensions["fof-user-directory"].components&&flarum.extensions["fof-user-directory"].components.SearchField){var t=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).allTerms=null,e.loadingAllTermsPromise=null,e.loading=!1,e.suggestions=[],e}Object(L.a)(e,t);var o=e.prototype;return o.resourceType=function(){return"flamarkt-taxonomy-terms"},o.search=function(t){var e=this;this.loading=!0,this.loadTerms().then((function(){e.loading=!1,e.suggestions=[],t?(t=t.toLowerCase(),e.allTerms.forEach((function(o){-1!==o.name().toLowerCase().indexOf(t)&&e.suggestions.push(o)})),m.redraw()):m.redraw()}))},o.loadTerms=function(){var t=this;if(this.loadingAllTermsPromise)return this.loadingAllTermsPromise;if(null!==this.allTerms)return Promise.resolve(null);this.allTerms=[];var e=[];return app.store.all("flamarkt-taxonomies").filter(N("users")).forEach((function(o){e.push(app.request({method:"GET",url:app.forum.attribute("apiUrl")+o.apiEndpoint()+"/terms"}).then((function(e){var n,a=app.store.pushPayload(e);a.forEach((function(t){t.pushData({relationships:{taxonomy:o}})})),(n=t.allTerms).push.apply(n,a)})))})),this.loadingAllTermsPromise=Promise.all(e),this.loadingAllTermsPromise.then((function(){t.loadingAllTermsPromise=null}))},o.renderKind=function(t){return t.taxonomy().name()},o.renderLabel=function(t){return m(".UserDirectorySearchLabel",t.color()?{className:"colored",style:{backgroundColor:t.color()}}:{},[t.icon()?[i()(t.icon())," "]:null,t.name()])},o.applyFilter=function(t,e){t.q=t.q?t.q+" ":"",t.q+="taxonomy:"+e.taxonomy().slug()+":"+e.slug()},o.initializeFromParams=function(t){var e=this;if(!t.q)return Promise.resolve([]);var o=t.q.split(" ").filter((function(t){return 0===t.indexOf("taxonomy:")}));return o.length?this.loadTerms().then((function(){var t=[];return o.forEach((function(o){var n=o.split(":");if(!(n.length<3)){var a=e.allTerms.find((function(t){return t.slug()===n[2]&&t.taxonomy().slug()===n[1]}));a&&t.push(a)}})),t})):Promise.resolve([])},e}(flarum.extensions["fof-user-directory"].searchTypes.AbstractType);Object(n.extend)(flarum.extensions["fof-user-directory"].components.SearchField.prototype,"filterTypes",(function(e){e.add("flamarkt-taxonomies",new t,15)}))}}()}))}]);
//# sourceMappingURL=forum.js.map